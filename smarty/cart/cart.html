<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>我的购物车</title>
    <link rel="stylesheet" type="text/css" href="css/public.css">
    <link type="text/css" rel="stylesheet" rev="stylesheet" href="css/membercenter.css" />
    <script type="text/javascript" src="js/jQuery.1.8.2.min.js"></script>
    <style>
       div.cart div.cartEmpty{
           display: none;
       }
    </style>
</head>
<body>

<!-- 头部开始 -->
<div class="header">
    <div class="topBar">
        <div class="box">
            <ul class="topLeft">
                <li>
                    <span>欢迎您，来到易购网</span>
                </li>
                <li>
                    <a href="#">请登录</a>
                </li>
                <li>
                    <a href="#">免费注册</a>
                </li>
            </ul>
            <ul class="topRight">
                <li>
                    <a href="#">关注易购网</a>
                    <div class="qrcode">
                        <div class="arrow"></div>
                        <img src="images/qrcode.jpg" alt="">
                    </div>
                </li>
                <li>
                    <a href="#">帮助中心</a>
                </li>
                <li>
                    <a href="#">我的收藏</a>
                </li>
                <li>
                    <a href="#">我的订单</a>
                </li>
                <li>
                    <a href="#">用户中心</a>
                </li>
            </ul>
        </div>
    </div>
    <div class="logoBar box">
        <div class="logo lf">
            <a href="#"><img src="images/logo.png" alt="logo" /></a>
        </div>
        <div class="search lf">
            <form   action="search.php"  method='get'>
                <input type="text" name="keywords" placeholder="请输入商品关键字" class="lf">
                <button class="lf">搜索</button>
            </form>
            <div class="clearfix"></div>
            <div class="hotSearch">
                <a href="">平板电脑</a>
                <a href="">平板电脑</a>
                <a href="">平板电脑</a>
                <a href="">平板电脑</a>
                <a href="">平板电脑</a>
                <a href="">平板电脑</a>
                <a href="">平板电脑</a>
                <a href="">平板电脑</a>
            </div>

        </div>
        <div class="cart lf">
            <div class="myCart">
                <i></i>
                <a  href="/home/cart/mycart.php">我的购物车</a>
                <span class="cartNum">0</span>
            </div>
            <div class="cartGoods">
                <h3>最新加入的商品</h3>
                <ul>

                </ul>
                <div class="cartSum">
                    <span>共<b class="cartNum">3</b>件商品</span>
                    <span>共计¥ <b class="cartPrice">47983.00</b></span>
                    <a href="#">去购物车</a>
                </div>
            </div>
            <div class="cartEmpty">
                <img src="images/empty_cart.png" alt="">
                购物车中还没有商品，赶紧选购吧！
            </div>

        </div>
    </div>
    <div class="menuBar">
        <ul class="box">
            <li class="category"  >
                <a href="">全部商品分类</a>
                <div id="nav" style="display: none">

                    <dl onmouseover="this.lastChild.style.display='block';" onmouseout="this.lastChild.style.display='none';">
                        <dt>
                            <a href="">苹果s8</a>
                        </dt>
                        <dd>
                            <a href="">华为mate9</a>
                        </dd>
                        <dd>
                            <a href="">iphone7s</a>
                        </dd>
                        <dd>
                            <a href="">note5</a>
                        </dd>
                        <div class="nextList">
                            <div class="cateLeft">

                                <div class="clist">
                                    <div class="listTitle">
                                        <a href="search.php?typeid=<?=$vv['id']?>">手机&gt;</a>
                                    </div>
                                    <div class="listContent">

                                        <a href="search.php?typeid=<?=$vvv['id']?>">测试机</a>

                                    </div>
                                </div>

                            </div>
                            <div class="cateRight">
                                <img src="images/cateAd1.jpg" />
                                <img src="images/cateAd1.jpg" />
                                <img src="images/cateAd1.jpg" />
                            </div>
                        </div></dl>
                </div>
            </li>
            <li>
                <a href="" class="current">首页</a>
            </li>
            <li>
                <a href="">热卖专区</a>
            </li>
            <li>
                <a href="">积分商城</a>
            </li>
            <li>
                <a href="">品牌专卖</a>
            </li>
            <li>
                <a href="">限时秒杀</a>
            </li>
        </ul>
    </div>
</div>
    <!-- 头部结束 -->
<div class="buyer_day box">
    <p class="select_title"><span>我的购物车</span></p>
    <table width="100%" border="0" cellpadding="0" cellspacing="0" class="day_list">
        <thead>
        <tr>
            <th class="xuhao"></th>
            <th width="15%">商品图片</th>
            <th width="30%">商品名称</th>
            <th width="10%">商品单价(元)</th>
            <th width="20%">商品数量</th>
            <th width="10%">小计(元)</th>
            <th width="5%">操作</th>
        </tr>
        </thead>
        <form action="a.py" method="post" id="form1">
            <input type="hidden" name="order_price" value="" id="order_price"/>
        <tbody id="pageBody">
       
        <tr>
            <td class="xuhao" style="color: #ff0000">
                <input checked="checked" value="1"  type="checkbox" name="chk[]" />
            </td>
            <td >
                <a href="">
                    <img src="images/thumb_50_img3.jpg" alt="" style="width:80px;margin:10px;" />
                </a>
            </td>
            <td ><a href="#">商品1</a></td>
            <td ><a href="#" class="price">1000</a></td>
            <td >
                <a href="javascript:;" class="decrement">-</a>&nbsp;
                <input type="text" name="1" value="1" class="num"   />&nbsp;
                <a href="javascript:;" class="increment">+</a>
            <td class="prices"></td>
            <td ><a href="javascript:;" class="delete">删除</a></td>
        </tr>

         <tr>
            <td class="xuhao" style="color: #ff0000">
                <input checked="checked" value="2"  type="checkbox" name="chk[]" />
            </td>
            <td >
                <a href="">
                    <img src="images/thumb_50_img3.jpg" alt="" style="width:80px;margin:10px;" />
                </a>
            </td>
            <td ><a href="#">商品2</a></td>
            <td ><a href="#" class="price">2000</a></td>
            <td >
                <a href="javascript:;" class="decrement">-</a>&nbsp;
                <input type="text" name="2" value="5" class="num"   />&nbsp;
                <a href="javascript:;" class="increment">+</a>
            <td class="prices"></td>
            <td ><a href="javascript:;" class="delete">删除</a></td>
        </tr>

         <tr>
            <td class="xuhao" style="color: #ff0000">
                <input checked="checked" value="3"  type="checkbox" name="chk[]" />
            </td>
            <td >
                <a href="">
                    <img src="images/thumb_50_img3.jpg" alt="" style="width:80px;margin:10px;" />
                </a>
            </td>
            <td ><a href="#">商品3</a></td>
            <td ><a href="#" class="price">666</a></td>
            <td >
                <a href="javascript:;" class="decrement">-</a>&nbsp;
                <input type="text" name="3" value="10" class="num"  />&nbsp;
                <a href="javascript:;" class="increment">+</a>
            <td class="prices"></td>
            <td ><a href="javascript:;" class="delete">删除</a></td>
        </tr>

       
        <tr>
            <td  class="xuhao" style="color: #ff0000">
                <input type="checkbox"  checked="checked"  id="chkAll" name="chkAll" />
            </td>
            <td  class="xuhao" style="color: #ff0000">
                <a href="javascript:;" class="deleteAll">删除选中</a>
            </td>
            <td colspan="5" id="buy">
                <span>总价:<b id="totalprice">￥888.88</b></span>
                <a href="javascript:;" class="tobuy">去结算</a>
            </td>
        </tr>
        </tbody>
        </form>
    </table>
</div>
</body>
<script>

    //鼠标划过购物车图标显示购物车商品列表
    $('.cart').hover(
        function(event){
            if(event.target.nodeName == "DIV"){
                console.log('aaa');
                str = '';
                $.ajax({
                    url: "select_car.php?act=select_car&id=31",
                    data: '',
                    dataType: 'json',
                    success: function (rel) {
                        console.log(rel)
                        for (var i = 0; i < rel.length; i++) {
                            str += '<li>' +
                                '<div class="lf">' +
                                '<img src="images/cart_goods1.jpg" alt="">' +
                                '<a href="#">' + rel[i].goodsname + '</a>' +
                                '</div>' +
                                '<div class="rf">' +
                                '&yen;<span class="goodsPrice">' + rel[i].price + '</span>' +
                                '&times;<span class="goodsNum">' + rel[i].buynum + '</span>' +
                                '<p><a href="#"  class="goodsDelete" id="'+rel[i].id+'">删除</a></p>' +
                                '</div>' +
                                '</li>'
                        }
                        $(".cartGoods ul").html(str);
                    }
                })
            }
            cartPrice();
            cartNum();
            $('.myCart').css('backgroundColor','#fff');
            $('.cartGoods li').length > 0 ? $('.cartGoods').show() : $('.cartEmpty').show();
        },
        function(){
            $('.myCart').css('backgroundColor','transparent').nextAll().hide();
        },
        //鼠标滑过发送请求，查询购物车信息

    )




    //计算购物车商品数量
    function cartNum(){
        var cartNum = $('.cartGoods li').length;
        $('.cartNum').text(  cartNum );
        if(cartNum == 0){
            $('.cartEmpty').show();
            $('.cartGoods').hide();
        }
    }

    cartNum();

    //计算购物车的总价
    function cartPrice(){
        var cartPrice = 0;
        $('.goodsPrice').each(function(index){
            cartPrice += parseFloat( $(this).text() ) * parseInt( $('.goodsNum').eq(index).text() )
        });

        $('.cartPrice').text(cartPrice);
    }
    cartPrice();

    //删除购物车的商品
    $('.cartGoods ul').on('click','.goodsDelete',function(){
        me=this
        $.post('select_car.php?act=del',{id:$(this).attr('id')},function(res){
            if(res[0] == "ok"){
                console.log(res[1]);
                $(me).closest('li').detach();
                cartNum();
                cartPrice();
            }
        },'json')
    });




    //小计价格4
    function getPrice(){
        $('.prices').each(function(index){
            $(this).text( (parseFloat( $('.price').eq(index).text() ) * parseInt( $('.num').eq(index).val() ) ).toFixed(2) );
        })
    }

    //总价
    function getTotalPrice(){
        getPrice();
        //假设总价为totalprice
        var totalprice = 0;
        $('input[name="chk[]"]').each(function(index){
            if($(this).prop('checked')){
                totalprice += parseFloat($('.prices').eq(index).text());
            }
        });
        $('#totalprice').html("&yen;" + totalprice.toFixed(2));
    }

    getTotalPrice();

    //全选全不选
    $('input[name="chkAll"]').click(function(){
        $('input[name="chk[]"]').prop( 'checked', $(this).prop('checked') );
        //重新计算总价
        getTotalPrice();
    });

    $('input[name="chk[]"]').click(function(){
        $('input[name="chkAll"]').prop( 'checked' , !$('input[name="chk[]"]:not(:checked)').length );
        getTotalPrice();
    });

    //减少数量
    $('.decrement').click(function(){
        $(this).next('input').val( function(index,value){
            return value>1 ? --value : 1;
        } );

        getTotalPrice();
    });

    //增加数量
    $('.increment').click(function(){
        $(this).prev('input').val( function(index,value){
            return value<10 ? ++value : 10;
        } );

        getTotalPrice();
    });

    //手动修改数量
    $('.num').keyup(function(){
        $(this).val( function(index,value){
           return ( value<1 || isNaN(value) )? 1 : (value>10 ? 10 : value);
        });

        getTotalPrice();
    });

    //删除
    $('.delete').click(function(){
        if(confirm('确认删除?')){
            $(this).closest('tr').detach();
        }

        getTotalPrice();
    });

    //批量删除
    $('.deleteAll').click(function(){
        if(confirm('确认删除?')){
            $('input[name="chk[]"]:checked').each(function(){
                $(this).closest('tr').detach();
            });
        }
        getTotalPrice()
    });

    //去结算
    $('.tobuy').click(function(){
        //判断有没勾选要结算的商品
        if($('input[name="chk[]"]:checked').length > 0){
            //提交表单
            $('#form1').submit();
        }else{
            alert('请选择要结算的商品');
        }
    })

</script>
</html>
